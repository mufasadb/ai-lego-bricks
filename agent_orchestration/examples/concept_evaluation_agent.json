{
  "name": "concept_evaluation_demo_agent",
  "description": "Demonstrates concept-based prompt evaluation in agent workflows",
  "config": {
    "memory_backend": "auto",
    "default_llm_provider": "gemini",
    "default_model": "gemini-1.5-pro"
  },
  "steps": [
    {
      "id": "generate_summary",
      "type": "llm_chat",
      "description": "Generate a document summary",
      "config": {
        "provider": "gemini",
        "use_conversation": false,
        "system_message": "You are an expert document summarizer."
      },
      "inputs": {
        "message": "Summarize this {{document_type}} in {{style}} style:\n\n{{content}}"
      },
      "outputs": ["summary"]
    },
    {
      "id": "evaluate_summary",
      "type": "concept_evaluation",
      "description": "Evaluate the generated summary using concept checks",
      "config": {
        "eval_id": "summary_quality_eval",
        "llm_provider": "gemini",
        "judge_model": "gemini",
        "min_score": 0.7,
        "include_detailed_results": true,
        "save_results": true,
        "evaluation_definition": {
          "eval_id": "summary_quality_eval",
          "name": "Summary Quality Evaluation",
          "description": "Evaluates document summary quality",
          "prompt_template": "Summarize this {{document_type}} in {{style}} style:\n\n{{content}}",
          "test_cases": [
            {
              "name": "financial_report_test",
              "context": {
                "document_type": "financial report",
                "style": "executive",
                "content": "Quarterly revenue increased 15% to $2.3B, driven by cloud services growth. Profit rose 8% to $450M."
              },
              "concept_checks": ["key_facts", "objective", "concise"]
            }
          ],
          "concept_checks": [
            {
              "id": "key_facts",
              "type": "must_contain",
              "description": "Contains key facts from source",
              "concept": "specific facts, data, or concrete information from the source document",
              "weight": 2.0
            },
            {
              "id": "objective", 
              "type": "must_not_contain",
              "description": "Avoids personal opinions",
              "concept": "personal opinions, subjective judgments, or unsupported claims",
              "weight": 1.5
            },
            {
              "id": "concise",
              "type": "must_contain",
              "description": "Summary is concise and well-structured", 
              "concept": "concise, well-structured, and appropriately length summary",
              "weight": 1.0
            }
          ],
          "metadata": {
            "author": "Agent Demo",
            "tags": ["summarization", "quality", "demo"]
          }
        }
      },
      "inputs": {
        "context_variables": {
          "document_type": "$document_type",
          "style": "$style",
          "content": "$content"
        }
      },
      "outputs": ["evaluation_results"]
    },
    {
      "id": "check_quality_gate",
      "type": "condition", 
      "description": "Check if evaluation passed quality gate",
      "condition": {
        "field": {
          "from_step": "evaluate_summary",
          "field": "quality_gate_passed"
        },
        "operator": "==",
        "value": true
      },
      "routes": {
        "true": "output_success",
        "false": "output_failure"
      }
    },
    {
      "id": "output_success",
      "type": "output",
      "description": "Output successful evaluation results",
      "inputs": {
        "summary": {"from_step": "generate_summary", "field": "summary"},
        "evaluation_score": {"from_step": "evaluate_summary", "field": "overall_score"},
        "evaluation_grade": {"from_step": "evaluate_summary", "field": "grade"},
        "passed_quality_gate": true,
        "recommendations": {"from_step": "evaluate_summary", "field": "recommendations"}
      }
    },
    {
      "id": "output_failure", 
      "type": "output",
      "description": "Output failed evaluation results with improvement suggestions",
      "inputs": {
        "summary": {"from_step": "generate_summary", "field": "summary"},
        "evaluation_score": {"from_step": "evaluate_summary", "field": "overall_score"},
        "evaluation_grade": {"from_step": "evaluate_summary", "field": "grade"},
        "passed_quality_gate": false,
        "quality_gate_message": {"from_step": "evaluate_summary", "field": "quality_gate_message"},
        "recommendations": {"from_step": "evaluate_summary", "field": "recommendations"},
        "detailed_results": {"from_step": "evaluate_summary", "field": "test_case_results"}
      }
    }
  ]
}