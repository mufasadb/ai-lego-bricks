{
  "name": "conversation_with_manual_messages",
  "description": "Demonstrates manually adding messages to conversations and using conversation context",
  "config": {
    "memory_backend": "auto",
    "default_llm_provider": "gemini",
    "default_model": "gemini-1.5-flash"
  },
  "steps": [
    {
      "id": "start_conversation",
      "type": "start_conversation",
      "description": "Start a customer support conversation",
      "config": {
        "conversation_id": "support_ticket",
        "name": "Customer Support Session",
        "system_message": "You are a helpful customer support agent. Be empathetic and solution-focused."
      },
      "outputs": ["conversation_id"]
    },
    {
      "id": "add_customer_context",
      "type": "add_to_conversation",
      "description": "Add customer information as context",
      "config": {
        "conversation_id": "support_ticket",
        "role": "user"
      },
      "inputs": {
        "content": "Customer ID: 12345, Premium Plan, Issue Category: Billing"
      },
      "outputs": ["message_timestamp"]
    },
    {
      "id": "get_customer_issue",
      "type": "input",
      "description": "Get the customer's actual issue",
      "config": {
        "prompt": "Please describe your issue:"
      },
      "outputs": ["customer_issue"]
    },
    {
      "id": "add_issue_to_conversation",
      "type": "add_to_conversation",
      "description": "Add the customer issue to conversation",
      "config": {
        "conversation_id": "support_ticket",
        "role": "user"
      },
      "inputs": {
        "content": {
          "from_step": "get_customer_issue",
          "field": "customer_issue"
        },
        "metadata": {
          "type": "customer_issue",
          "priority": "normal"
        }
      },
      "outputs": ["total_messages"]
    },
    {
      "id": "generate_support_response",
      "type": "llm_chat",
      "description": "Generate support response with full conversation context",
      "config": {
        "provider": "gemini",
        "use_conversation": true,
        "conversation_id": "support_ticket",
        "include_system_messages": true,
        "history_limit": 0
      },
      "inputs": {
        "message": "Based on the customer information and issue described, provide a helpful response with potential solutions."
      },
      "outputs": ["response"]
    },
    {
      "id": "add_agent_response",
      "type": "add_to_conversation",
      "description": "Add the agent response to conversation history",
      "config": {
        "conversation_id": "support_ticket",
        "role": "assistant"
      },
      "inputs": {
        "content": {
          "from_step": "generate_support_response",
          "field": "response"
        },
        "metadata": {
          "type": "agent_response",
          "response_time": "immediate"
        }
      },
      "outputs": ["final_message_count"]
    },
    {
      "id": "escalation_check",
      "type": "condition",
      "description": "Check if escalation is needed",
      "config": {
        "condition_type": "llm_decision",
        "condition_prompt": "Based on the conversation so far, does this issue require escalation to a senior agent?",
        "route_options": ["escalate", "resolved"],
        "provider": "gemini"
      },
      "inputs": {
        "conversation_context": {
          "from_step": "generate_support_response",
          "field": "response"
        }
      },
      "routes": {
        "escalate": "escalation_notice",
        "resolved": "completion_summary"
      }
    },
    {
      "id": "escalation_notice",
      "type": "add_to_conversation",
      "description": "Add escalation notice",
      "config": {
        "conversation_id": "support_ticket",
        "role": "system"
      },
      "inputs": {
        "content": "This ticket has been escalated to senior support.",
        "metadata": {
          "type": "escalation",
          "escalated_at": "system_generated"
        }
      },
      "outputs": ["escalation_added"]
    },
    {
      "id": "completion_summary",
      "type": "output",
      "description": "Output conversation summary",
      "config": {
        "format": "json"
      },
      "inputs": {
        "conversation_id": {
          "from_step": "start_conversation",
          "field": "conversation_id"
        },
        "customer_issue": {
          "from_step": "get_customer_issue",
          "field": "customer_issue"
        },
        "agent_response": {
          "from_step": "generate_support_response",
          "field": "response"
        },
        "total_messages": {
          "from_step": "add_agent_response",
          "field": "final_message_count"
        },
        "escalation_decision": {
          "from_step": "escalation_check",
          "field": "condition_result"
        }
      }
    }
  ]
}