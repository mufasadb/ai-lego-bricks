{
  "name": "document_analysis_agent",
  "description": "Comprehensive document processing with chunking, memory storage, and Q&A capabilities",
  "config": {
    "memory_backend": "auto",
    "default_llm_provider": "gemini",
    "default_model": "gemini-1.5-pro"
  },
  "steps": [
    {
      "id": "get_document_path",
      "type": "input",
      "description": "Get the document path to analyze",
      "config": {
        "prompt": "Please provide the path to the document you want to analyze:"
      },
      "outputs": ["document_path"]
    },
    {
      "id": "process_document",
      "type": "document_processing",
      "description": "Extract and enhance text from PDF",
      "config": {
        "enhance_with_llm": true,
        "semantic_analysis": true,
        "use_vision_fallback": true
      },
      "inputs": {
        "file_path": {
          "from_step": "get_document_path",
          "field": "document_path"
        }
      },
      "outputs": ["text", "semantic_analysis", "page_count"]
    },
    {
      "id": "chunk_document",
      "type": "chunk_text",
      "description": "Break document into semantic chunks",
      "config": {
        "target_size": 1000,
        "tolerance": 200,
        "overlap": 100
      },
      "inputs": {
        "text": {
          "from_step": "process_document",
          "field": "text"
        }
      },
      "outputs": ["chunks"]
    },
    {
      "id": "store_chunks",
      "type": "memory_store",
      "description": "Store document chunks in vector memory",
      "config": {
        "metadata": {
          "document_type": "pdf",
          "processing_date": "auto"
        }
      },
      "inputs": {
        "content": {
          "from_step": "chunk_document",
          "field": "chunks"
        },
        "metadata": {
          "source_file": {
            "from_step": "get_document_path",
            "field": "document_path"
          },
          "page_count": {
            "from_step": "process_document",
            "field": "page_count"
          }
        }
      },
      "outputs": ["memory_id", "stored_count"]
    },
    {
      "id": "get_user_question",
      "type": "input",
      "description": "Get user's question about the document",
      "config": {
        "prompt": "What would you like to know about this document?"
      },
      "outputs": ["question"]
    },
    {
      "id": "retrieve_relevant_info",
      "type": "memory_retrieve",
      "description": "Find relevant information from stored document",
      "config": {
        "limit": 5,
        "threshold": 0.7
      },
      "inputs": {
        "query": {
          "from_step": "get_user_question",
          "field": "question"
        }
      },
      "outputs": ["memories", "relevance_scores"]
    },
    {
      "id": "generate_answer",
      "type": "llm_chat",
      "description": "Generate comprehensive answer based on retrieved context",
      "config": {
        "provider": "gemini",
        "model": "gemini-1.5-pro",
        "temperature": 0.3,
        "max_tokens": 1500,
        "system_message": "You are a document analysis expert. Provide comprehensive, accurate answers based on the provided context. Always cite specific sections when possible."
      },
      "inputs": {
        "message": "Context from document: {context}\n\nUser Question: {question}\n\nPlease provide a detailed answer based on the context provided, citing relevant sections.",
        "context": {
          "from_step": "retrieve_relevant_info",
          "field": "memories"
        },
        "question": {
          "from_step": "get_user_question",
          "field": "question"
        }
      },
      "outputs": ["response"]
    },
    {
      "id": "save_analysis",
      "type": "file_output",
      "description": "Save analysis results to file",
      "config": {
        "file_path": "output/document_analysis_results.json",
        "format": "json",
        "create_dirs": true
      },
      "inputs": {
        "content": {
          "document_path": {
            "from_step": "get_document_path",
            "field": "document_path"
          },
          "question": {
            "from_step": "get_user_question",
            "field": "question"
          },
          "answer": {
            "from_step": "generate_answer",
            "field": "response"
          },
          "chunks_stored": {
            "from_step": "store_chunks",
            "field": "stored_count"
          },
          "relevance_scores": {
            "from_step": "retrieve_relevant_info",
            "field": "relevance_scores"
          }
        }
      },
      "outputs": ["file_path", "success"]
    },
    {
      "id": "output_answer",
      "type": "output",
      "description": "Return the final analysis",
      "config": {
        "format": "json"
      },
      "inputs": {
        "answer": {
          "from_step": "generate_answer",
          "field": "response"
        },
        "analysis_file": {
          "from_step": "save_analysis",
          "field": "file_path"
        },
        "chunks_processed": {
          "from_step": "store_chunks",
          "field": "stored_count"
        }
      }
    }
  ]
}