{
  "name": "document_analysis_with_managed_prompts",
  "description": "Document analysis agent using managed prompts for analysis and Q&A",
  "config": {
    "memory_backend": "auto",
    "default_llm_provider": "gemini",
    "default_model": "gemini-1.5-pro"
  },
  "steps": [
    {
      "id": "process_document",
      "type": "document_processing",
      "description": "Extract and enhance text from PDF",
      "config": {
        "enhance_with_llm": true,
        "semantic_analysis": true
      },
      "inputs": {
        "file_path": "$document_path"
      },
      "outputs": ["text", "key_points"]
    },
    {
      "id": "analyze_document",
      "type": "llm_structured",
      "description": "Analyze document using managed prompt",
      "prompt_ref": {
        "prompt_id": "document_analysis",
        "version": "1.0.0",
        "context_variables": {
          "focus_areas": ["main topics", "key findings", "recommendations", "metrics"]
        }
      },
      "config": {
        "provider": "gemini",
        "model": "gemini-1.5-pro",
        "response_schema": {
          "name": "DocumentAnalysis",
          "fields": {
            "summary": {"type": "string", "description": "Brief summary of the document"},
            "main_topics": {"type": "list", "description": "List of main topics covered"},
            "key_findings": {"type": "list", "description": "Important findings or insights"},
            "recommendations": {"type": "list", "description": "Any recommendations mentioned"},
            "confidence": {"type": "float", "description": "Confidence in analysis (0-1)"}
          }
        }
      },
      "inputs": {
        "document_text": {
          "from_step": "process_document",
          "field": "text"
        }
      },
      "outputs": ["structured_response", "prompt_id", "prompt_version"]
    },
    {
      "id": "store_analysis",
      "type": "memory_store",
      "description": "Store document analysis in memory",
      "config": {
        "metadata": {
          "document_type": "analyzed_document",
          "analysis_version": "1.0"
        }
      },
      "inputs": {
        "content": {
          "from_step": "analyze_document",
          "field": "summary"
        },
        "metadata": {
          "source_file": "$document_path",
          "analysis_data": {
            "from_step": "analyze_document",
            "field": "structured_response"
          }
        }
      },
      "outputs": ["memory_id"]
    },
    {
      "id": "get_user_question",
      "type": "input",
      "description": "Get user's question about the document",
      "config": {
        "prompt": "What would you like to know about this document?"
      },
      "outputs": ["question"]
    },
    {
      "id": "retrieve_context",
      "type": "memory_retrieve",
      "description": "Find relevant information for the question",
      "config": {
        "limit": 3,
        "threshold": 0.7
      },
      "inputs": {
        "query": {
          "from_step": "get_user_question",
          "field": "question"
        }
      },
      "outputs": ["memories"]
    },
    {
      "id": "answer_question",
      "type": "llm_chat",
      "description": "Answer user question using managed prompt",
      "prompt_ref": {
        "prompt_id": "document_qa",
        "version": "1.0.0",
        "context_variables": {
          "persona": "an expert document analyst"
        }
      },
      "config": {
        "provider": "gemini",
        "model": "gemini-1.5-pro"
      },
      "inputs": {
        "user_question": {
          "from_step": "get_user_question",
          "field": "question"
        },
        "document_analysis": {
          "from_step": "analyze_document",
          "field": "structured_response"
        },
        "context_memories": {
          "from_step": "retrieve_context",
          "field": "memories"
        }
      },
      "outputs": ["response", "prompt_id", "prompt_version"]
    },
    {
      "id": "output_final_result",
      "type": "output",
      "description": "Return complete analysis and answer",
      "config": {
        "format": "json"
      },
      "inputs": {
        "document_analysis": {
          "from_step": "analyze_document",
          "field": "structured_response"
        },
        "user_question": {
          "from_step": "get_user_question",
          "field": "question"
        },
        "answer": {
          "from_step": "answer_question",
          "field": "response"
        },
        "prompts_used": {
          "analysis_prompt": {
            "from_step": "analyze_document",
            "field": "prompt_id"
          },
          "qa_prompt": {
            "from_step": "answer_question",
            "field": "prompt_id"
          }
        }
      }
    }
  ]
}