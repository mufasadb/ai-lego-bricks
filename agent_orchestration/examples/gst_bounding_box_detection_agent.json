{
  "name": "GST Bounding Box Detection Agent",
  "description": "Agent that uses LLaVA vision model to detect GST amounts in invoices and return bounding box coordinates",
  "config": {
    "default_llm_provider": "gemini"
  },
  "steps": [
    {
      "id": "load_invoice_document",
      "type": "document_processing",
      "description": "Load and process the Zoom invoice PDF",
      "inputs": {
        "file_path": "zoom_invoice_august.pdf"
      },
      "config": {
        "force_vision_processing": true,
        "use_vision_fallback": true,
        "llm_provider": "gemini",
        "vision_prompt": "Process this invoice document for vision analysis. Convert each page to an image for detailed examination."
      },
      "outputs": ["vision_text", "processing_method", "page_images"]
    },
    {
      "id": "detect_gst_with_gemini_vision",
      "type": "llm_vision",
      "description": "Use Gemini Vision model to detect GST amount and return bounding box coordinates",
      "inputs": {
        "image_path": {"from_step": "load_invoice_document", "field": "page_images"},
        "prompt": "Analyze this invoice image and locate the GST (Goods and Services Tax) dollar amount. I need you to:\n\n1. Identify the specific GST amount in dollars\n2. Provide the exact bounding box coordinates where this amount appears\n3. Return the coordinates in the format: x_min, y_min, x_max, y_max (as pixel coordinates)\n4. Also provide the GST amount value you found\n\nPlease respond in this exact JSON format:\n{\n  \"gst_amount\": \"$X.XX\",\n  \"bounding_box\": {\n    \"x_min\": 0,\n    \"y_min\": 0,\n    \"x_max\": 0,\n    \"y_max\": 0\n  },\n  \"confidence\": \"high/medium/low\",\n  \"description\": \"Brief description of where you found the GST amount\"\n}\n\nFocus on precision and accuracy in coordinate detection."
      },
      "config": {
        "provider": "gemini",
        "model": "gemini-1.5-flash",
        "temperature": 0.1,
        "max_tokens": 500
      },
      "outputs": ["response", "vision_analysis"]
    },
    {
      "id": "validate_and_format_results",
      "type": "llm_chat",
      "description": "Validate the detected GST coordinates and format the final results",
      "inputs": {
        "message": "Review the GST detection results and validate the format. Ensure the bounding box coordinates are reasonable and the GST amount is properly formatted. If the results look valid, return them as-is. If there are issues, note them in the validation_notes field.\n\nDetection Results: {from_step.detect_gst_with_gemini_vision.response}\n\nReturn in JSON format:\n{\n  \"validated_gst_amount\": \"$X.XX\",\n  \"validated_bounding_box\": {\n    \"x_min\": 0,\n    \"y_min\": 0,\n    \"x_max\": 0,\n    \"y_max\": 0\n  },\n  \"validation_status\": \"valid/invalid/needs_review\",\n  \"validation_notes\": \"Any issues or observations\",\n  \"frontend_ready\": true/false\n}"
      },
      "config": {
        "provider": "gemini",
        "model": "gemini-1.5-flash",
        "temperature": 0.1,
        "max_tokens": 300
      },
      "outputs": ["response"]
    },
    {
      "id": "final_output",
      "type": "output",
      "description": "Return GST detection results with bounding box coordinates",
      "inputs": {
        "gst_detection_result": {"from_step": "detect_gst_with_gemini_vision", "field": "response"},
        "validation_result": {"from_step": "validate_and_format_results", "field": "response"},
        "source_document": "zoom_invoice_august.pdf",
        "processing_method": {"from_step": "load_invoice_document", "field": "processing_method"}
      }
    }
  ]
}